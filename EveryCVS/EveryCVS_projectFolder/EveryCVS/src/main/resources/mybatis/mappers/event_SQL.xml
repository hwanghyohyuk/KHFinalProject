<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="event">

	<resultMap id="resultEvent" type="event">
		<result property="event_no" column="EVENT_NO" />
		<result property="title" column="TITLE" />
		<result property="writer" column="WRITER" />
		<result property="contents" column="CONTENTS" />
		<result property="start_date" column="START_DATE" />
		<result property="end_date" column="END_DATE" />
		<result property="join_limit" column="JOIN_LIMIT" />
		<result property="readcount" column="READCOUNT" />
		<result property="original_file_name" column="ORIGINAL_FILE_NAME" />
		<result property="stored_file_name" column="STORED_FILE_NAME" />
		<result property="del_check" column="DEL_CHECK" />
	</resultMap>
	
	
	<!-- 이벤트 리스트 조회 -->
	<select id="cvseventlist" resultType="list" resultMap="resultEvent">
		<![CDATA[
			SELECT * FROM EVENT_VIEW ORDER BY EVENT_NO DESC
		]]>
	</select>
	
	<!-- 글작성 -->
	<insert id="cvseventwrite" parameterType="event" flushCache="true"
      statementType="PREPARED" useGeneratedKeys="true">
	<![CDATA[
		insert into TB_EVENT values (seq_event_no.nextval, 
					#{title},#{writer},#{contents},#{start_date},
					#{end_date},#{join_limit}, #{original_file_name, jdbcType=VARCHAR}, #{stored_file_name, jdbcType},
					default,default)
		]]>
	</insert>
	
	<!-- 이벤트 사용자 상세보기 -->
	<select id="eventDetail" resultType="Event" resultMap="resultEvent">
		<![CDATA[
		select * 
		from EVENT_VIEW
		where event_no=#{event_no}
		]]>
	</select>
	
	<!-- 조회수 증가 시키기  -->
	<update id="eventReadCount" parameterType="_int" flushCache="true">
		<![CDATA[
		update tb_event set readcount = readcount + 1 where event_no=#{event_no}
		]]>
	</update>
	
	<!-- 이벤트 게시글 삭제 -->
	<delete id="eventDelete" parameterType="_int">
		<![CDATA[
		delete from tb_event where event_no=#{event_no}
		]]>
	</delete>
	
</mapper>