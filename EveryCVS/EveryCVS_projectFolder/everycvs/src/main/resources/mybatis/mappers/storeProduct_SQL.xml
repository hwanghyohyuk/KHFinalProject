<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="storeProduct"> 

	<resultMap id="resultStoreProduct" type="storeproduct">
		<result property="store_product_no" column="STORE_PRODUCT_NO" />
		<result property="store_no" column="STORE_NO" />
		<result property="product_no" column="PRODUCT_NO" />
		<result property="product_name" column="PRODUCT_NAME" />
		<result property="manufacturer" column="MANUFACTURER" />
		<result property="price" column="PRICE" />
		<result property="manufacture_date" column="MANUFACTURE_DATE" />
		<result property="expiration_date" column="EXPIRATION_DATE" />
		<result property="expiration_hour" column="EXPIRATION_HOUR" />
		<result property="quantity" column="QUANTITY" />
		<result property="product_kind_no" column="PRODUCT_KIND_NO" />
		<result property="product_kind_name" column="PRODUCT_KIND_NAME" />
		<result property="brand_no" column="BRAND_NO" />
		<result property="brand_name" column="BRAND_NAME" />
		<result property="original_file_name" column="ORIGINAL_FILE_NAME" />
		<result property="stored_file_name" column="STORED_FILE_NAME" />
		<result property="del_check" column="DEL_CHECK" />
		<result property="purchase_count" column="PURCHASE_COUNT" />
		<result property="discount_no" column="DISCOUNT_NO" />
		<result property="discount_info" column="DISCOUNT_INFO" />
		<result property="discount_name" column="DISCOUNT_NAME" />
		<result property="start_date" column="START_DATE" />
		<result property="end_date" column="END_DATE" />
		<result property="expiration_rate" column="EXPIRATION_RATE" />
		<result property="discount_rate" column="DISCOUNT_RATE" />
		<result property="expiration_price" column="EXPIRATION_PRICE" />
	</resultMap>
	
	<select id="getListCount" resultType="int">
		select count(*) from store_popularity_product_view
	</select>
	
	<select id="getSearchListCount" parameterType="hashmap" resultType="int">
		select count(*) from store_popularity_product_view where product_name like #{keyword}
	</select>
	
	<select id="selectList" parameterType="hashmap" resultType="list" resultMap="resultStoreProduct">
		   <![CDATA[
      		select * from (
            select rownum rnum, a.*
            from store_popularity_product_view a)
            where rnum >= #{startRow} and rnum <= #{endRow}
           ]]>
   </select>

   <select id="searchSproduct" parameterType="hashmap" resultType="list" resultMap="resultStoreProduct">
		   <![CDATA[
		    select * from (
		    select rownum rnum, store_product_no, product_name, price
		    from store_popularity_product_view)
		    where rnum >= #{startRow} and rnum <= #{endRow}
		    and product_name like #{keyword}
           ]]>
   </select>
   
   <select id="top3Sproduct" resultType="list" resultMap="resultStoreProduct">
		<![CDATA[
			select * from (select rownum rnum, store_product_no, product_name, price, manufacturer, manufacture_date
			from (select * from store_popularity_product_view order by purchase_count desc)) 
			where rnum >= 1 and rnum <= 3
		]]>	
	</select>
	
	<select id="new3Sproduct" resultType="list" resultMap="resultStoreProduct">
		<![CDATA[
			select * from (select rownum rnum, store_product_no, product_name, price, manufacturer, manufacture_date
			from (select * from store_popularity_product_view order by manufacture_date desc)) 
			where rnum >= 1 and rnum <= 3
		]]>	
	</select>
	
	<select id="dcSproduct" parameterType="java.util.Map" resultType="list" resultMap="resultStoreProduct">
		   <![CDATA[
      		select * from store_popularity_product_view where discount_no is not null
           ]]>
   </select>
   
   <select id="expSproduct" parameterType="java.util.Map" resultType="list" resultMap="resultStoreProduct">
		   <![CDATA[
      		select * from store_popularity_product_view where expiration_hour <= 72 and expiration_hour > 0
           ]]>
   </select>
	
	<select id="listSpmanager" parameterType="java.util.Map" resultType="list" resultMap="resultStoreProduct">
		   <![CDATA[
      		select * from (
            select rownum rnum, a.*
            from store_popularity_product_view a)
            where rnum >= #{startRow} and rnum <= #{endRow}
           ]]>
   </select>
   
   <select id="searchSpmanager" parameterType="hashmap" resultType="list" resultMap="resultStoreProduct">
		   <![CDATA[
		    select * from (
		    select rownum rnum, store_product_no, product_kind_name, product_name,
		    manufacturer, price, discount_name, manufacture_date, quantity
		    from store_popularity_product_view)
		    where rnum >= #{startRow} and rnum <= #{endRow}
		    and product_name like #{keyword}
           ]]>
   </select>
     
   <update id="deleteSpmanager" parameterType="hashmap">
   		<![CDATA[
			update tb_store_product set del_check = #{toggle} where store_product_no = #{spnum}
		]]>
   </update>
   
   <update id="updateSpmanager" parameterType="hashmap">
		update tb_store_product 
		set manufacture_date = #{manufacturedate}, quantity = #{quantity} where store_product_no = #{spnum}
   </update>
   
   <select id="listApmanager" parameterType="java.util.Map" resultType="list" resultMap="resultStoreProduct">
		   <![CDATA[
      		select * from (
            select rownum rnum, a.*
            from tb_product a)
            where rnum >= #{startRow} and rnum <= #{endRow}
           ]]>
   </select>
   
   <select id="searchApmanager" parameterType="hashmap" resultType="list" resultMap="resultStoreProduct">
		   <![CDATA[
		    select * from (
		    select rownum rnum, store_product_no, product_kind_name, product_name,
		    manufacturer, price, discount_name
		    from store_popularity_product_view)
		    where rnum >= #{startRow} and rnum <= #{endRow}
		    and product_name like #{keyword}
           ]]>
   </select>
   
</mapper>	