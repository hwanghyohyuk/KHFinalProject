<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="product">
	<resultMap id="resultProduct" type="product">
		<result property="product_no" column="product_no" />
		<result property="product_name" column="product_name" />
		<result property="manufacturer" column="manufacturer" />
		<result property="price" column="price" />
		<result property="expiration_date" column="expiration_date" />
		<result property="product_kind_no" column="product_kind_no" />
		<result property="product_kind_name" column="product_kind_name" />
		<result property="brand_no" column="brand_no" />
		<result property="original_file_name" column="original_file_name" />
		<result property="stored_file_name" column="stored_file_name" />
		<result property="del_check" column="del_check" />
		<result property="purchase_count" column="purchase_count" />
	</resultMap>
	
	<!-- 금주의 인기 상품 top5 조회 -->
	<select id="hotProductTop5" parameterType="_int" resultType="list" resultMap="resultProduct">
		<![CDATA[
			
		]]>
	</select>
	
	<!-- 상품 리스트 조회 -->
	<select id="productList" parameterType="_int" resultType="list" resultMap="resultProduct">
		<![CDATA[
			select * from product_view
			where brand_no = #{brand_no}
			order by product_no asc
		]]>
	</select>
		
	<!-- 상품 검색 : 상품명 -->
	<select id="productSearch1" parameterType="product" resultType="list" resultMap="resultProduct">
		<![CDATA[
			select * from product_view
			where brand_no = #{brand_no}
			and product_name like #{product_name}
			order by product_no asc
		]]>
	</select>
	
	<!-- 상품 검색 : 제조사 -->
	<select id="productSearch2" parameterType="product" resultType="list" resultMap="resultProduct">
		<![CDATA[
			select * from product_view
			where brand_no = #{brand_no}
			and manufacturer like #{manufacturer}
			order by product_no asc
		]]>
	</select>
	
	<!-- 상품 분류 이름 조회 -->
	<select id="selectKindName" parameterType="_int" resultType="string">
		<![CDATA[
			select product_kind_name from tb_product_kind
			where product_kind_no = #{product_kind_no}
		]]>
	</select>
	
	<!-- 상품 등록 -->
	<insert id="insertProduct" parameterType="product">
		<![CDATA[
		int product_no; //상품번호
		 String product_name; //상품명
		 String manufacturer; //제조사
		 int price; //가격
		 int expiration_date; //유통기한
		 int product_kind_no; //상품종류번호
		 String product_kind_name; //상품종류명
		 int brand_no; //상호번호
		 String original_file_name; //첨부파일기존명
		 String stored_file_name; //첨부파일변경명
		 String del_check; //삭제구분
		 int purchase_count; //구매횟수
		]]>
	</insert>
	
	<!-- 상품 삭제 -->
	<!-- 연쇄 삭제 : 상품 테이블에서 상품 삭제 -->
	<delete id="deleteProduct3" parameterType="product" flushCache="true" statementType="PREPARED">
		<![CDATA[
			delete from tb_product
			where product_no = #{product_no}
			and brand_no = #{brand_no}
		]]>
	</delete>
	
	<!-- 연쇄 삭제 : 할인 상품 테이블에서 상품 삭제 -->
	<delete id="deleteProduct1" parameterType="product" flushCache="true" statementType="PREPARED">
		<![CDATA[
			delete from tb_dc_product
			where product_no = #{product_no}
		]]>
	</delete>
	
	<!-- 연쇄 삭제 : 지점 상품 테이블에서 상품 삭제 -->
	<delete id="deleteProduct2" parameterType="product" flushCache="true" statementType="PREPARED">
		<![CDATA[
			delete from tb_store_product
			where product_no = #{product_no}
		]]>
	</delete>
	
</mapper>

