<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="event">

	<resultMap id="resultEvent" type="event">
		<result property="event_no" column="EVENT_NO" />
		<result property="title" column="TITLE" />
		<result property="writer" column="WRITER" />
		<result property="contents" column="CONTENTS" />
		<result property="start_date" column="START_DATE" />
		<result property="end_date" column="END_DATE" />
		<result property="join_limit" column="JOIN_LIMIT" />
		<result property="readcount" column="READCOUNT" />
		<result property="original_file_name" column="ORIGINAL_FILE_NAME" />
		<result property="stored_file_name" column="STORED_FILE_NAME" />
		<result property="del_check" column="DEL_CHECK" />
	</resultMap>
	
	
	
	<!-- 게시글 갯수 조회 -->
	<select id="getListCount" resultType="_int">
		select count(*) from EVENT_VIEW
	</select>
	
	<!-- 이벤트 리스트 조회 -->
	<select id="cvseventlist" resultType="list" parameterType="hashmap" resultMap="resultEvent">
		<![CDATA[
			select * from (
            select rownum rnum, a.*
            from EVENT_VIEW a)
            where rnum >= #{startRow} and rnum <= #{endRow}
            order by EVENT_NO
		]]>
	</select>
	<!-- 제목 내용 검색 -->
	<select id="cvseventsearch" resultType="list" parameterType="hashmap" resultMap="resultEvent">
		<![CDATA[
			SELECT * FROM EVENT_VIEW where title like #{mainkeyword} or contents like #{subkeyword}
			ORDER BY EVENT_NO DESC
		]]>
	</select>
	
	
	<!-- 글작성 -->
	<insert id="cvseventwrite" parameterType="event" flushCache="true"
      statementType="PREPARED">
	<![CDATA[
		insert into TB_EVENT values (seq_event_no.nextval, 
					#{title},#{writer},#{contents},#{start_date},
					#{end_date},#{join_limit}, default, default,
					default,default)
		]]>
	</insert>
	
	<!-- 이벤트 사용자 상세보기 -->
	<select id="eventDetail" resultType="Event" resultMap="resultEvent">
		<![CDATA[
		select * 
		from EVENT_VIEW
		where event_no=#{event_no}
		]]>
	</select>
	
	<!-- 조회수 증가 시키기  -->
	<update id="eventReadCount" parameterType="_int" flushCache="true">
		<![CDATA[
		update tb_event set readcount = readcount + 1 where event_no=#{event_no}
		]]>
	</update>
	
	<!-- 이벤트 게시글 삭제 -->
	<delete id="eventDelete" parameterType="_int">
		<![CDATA[
		delete from tb_event where event_no=#{event_no}
		]]>
	</delete>
	
	<!-- 관리자 게시글 상세보기 -->
	<select id="cvsEventDetail" parameterType="_int" resultType="event" resultMap="resultEvent">
	<![CDATA[
		SELECT * FROM EVENT_VIEW where event_no = #{eno}
	]]>
	</select>
	
	<!-- 관리자 게시글 수정페이지 이동 -->
	<select id="cvseventmodifyview" parameterType="event" resultMap="resultEvent">
	<![CDATA[
		select * from tb_event where event_no=#{event_no}
		]]>
	</select>
	
	<!-- 관리자 게시글 수정-->
	<update id="cvseventmodifywrite" parameterType="event">
	<![CDATA[
		update tb_event 
		set 
			title = #{title},
			contents = #{contents},
			start_date = #{start_date},
			end_date = #{end_date},
			join_limit = #{join_limit},
			original_file_name = default,
			stored_file_name = default
		where event_no=#{event_no}
		]]>
	</update>
	
</mapper>